{% extends 'transfer_app/base.html' %}
{% load tz %}

{% block h1_title %}{{ object.bag_or_failed_name }} <small><span class="label label-{% include 'parts/status_class.html' with status=object.process_status %}">{{ object.get_process_status_display }}</span></small>{% endblock %}

{% block content %}

<div class="row">
	<div class="col-md-12">
		<p>Uploaded by {{ object.user_uploaded }} at {{ object.machine_file_upload_time}} and processed at {{ object.created_time }}</p>
	</div>
</div>

<div class="row">
	<div class="col-md-12">
		<div class="box box-primary">
			<div class="box-header with-border">
				<h3 class="box-title">Metadata</h3>
			</div>
			<div class="box-body">
				<dl class="dl-horizontal">
					<dt>Key</dt>
					<dd>Value</dd>
					<dt>Key</dt>
					<dd>Value</dd>
				</dl>
			</div>
		</div>
	</div>
</div>

{% if user.is_staff and object.appraisal_note %}
<div class="row">
	<div class="col-md-12">
		<div class="box box-{% if object.accepted %}success{% elif object.rejected %}danger{% endif %}">
			<div class="box-header with-border">
				<h3 class="box-title">Appraisal Information</h3>
			</div>
			<div class="box-body">
				<p>{{ object.appraisal_note }}</p>
			</div>
			{% if user.is_appraiser %}
			<div class="box-footer">
				<button type="submit" class="btn btn-primary">Save</button>
				<button type="cancel" class="btn btn-danger">Cancel</button>
			</div>
			{% endif %}
		</div>
	</div>
</div>
{% endif %}

<div class="row">
	<div class="col-md-12">
		<div class="box box-danger">
			<div class="box-header with-border">
				<h3 class="box-title">Error Messages</h3>
			</div>
			<div class="box-body">

				{% if object.get_errors %}
				<table>
					<thead>
						<tr>
							<th>Date/Time</th>
							<th>Summary</th>
							<th>Result</th>
						</tr>
					</thead>
					<tbody>
						{% for err in object.get_errors %}
						<tr>
							<td>{{ err.created_time }}</td>
							<td>{{ err.code.code_desc }}</td>
							<td></td>
						</tr>
						{% endfor %}
					</tbody>
				</table>
				{% else %}
				<p>No errors</p>
				{% endif %}
			</div>
		</div>
	</div>
</div>


{% if object.additional_error_info %}
<div class="row">
	<div class="col-md-12">
		<div class="box box-danger">
			<div class="box-header with-border">
				<h3 class="box-title">Additional Error Info</h3>
			</div>
			<div class="box-body">
				<p>{{ object.additional_error_info }}</p>
			</div>
		</div>
	</div>
</div>
{% endif %}

<div class="row">
	<div class="col-md-12">
		<div class="box box-info">
			<div class="box-header with-border">
				<h3 class="box-title">Log</h3>
			</div>
			<div class="box-body">
				<table>
					<thead>
						<tr>
							<th>Date/Time</th>
							<th>Message</th>
						</tr>
					</thead>
					<tbody>
						{% for tlog in object.get_transfer_logs %}
						<tr>
							<td>{{ tlog.created_time }}</td>
							<td>{{ tlog.code.code_desc }}</td>
						</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
		</div>
	</div>
</div>
{% endblock %}

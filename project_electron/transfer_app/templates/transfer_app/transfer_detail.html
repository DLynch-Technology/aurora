{% extends 'transfer_app/base.html' %}
{% load tz static %}
{% load util %}

{% block h1_title %}{{ object.bag_or_failed_name }} <small><span class="label label-{% include 'parts/status_class.html' with status=object.process_status %}">{{ object.get_process_status_display }}</span></small>{% endblock %}

{% block content %}

<div class="row">
	<div class="col-md-12">
		<p>Uploaded by {{ object.user_uploaded }} at {{ object.machine_file_upload_time}} and processed at {{ object.created_time }}</p>
	</div>
</div>

<div class="row">
	<div class="col-md-12">
		<div class="box box-primary">
			<div class="box-header with-border">
				<h3 class="box-title">Metadata</h3>
			</div>
			<div class="box-body">
				{% if object.get_bag_data %}
				<dl class="dl-horizontal">
					{% for k,v in object.get_bag_data.items %}
							<dt>{{k}}</dt>
							<dd>
								{% if v|get_type == 'list' %}
									{% for i in v %}
										{{ i }}<br/>
									{% endfor %}
								{% else %}
									{{v}}
								{% endif %}
							</dd>
					{% endfor %}
				</dl>
				{% else %}
				<p>No metadata available.</p>
				{% endif %}
			</div>
		</div>
	</div>
</div>

{% if user.is_staff and object.appraisal_note %}
<div class="row">
	<div class="col-md-12">
		<div class="box box-{% if object.accepted %}success{% elif object.rejected %}danger{% endif %}">
			<div class="box-header with-border">
				<h3 class="box-title">Appraisal Information</h3>
			</div>
			<div class="box-body">
				<p>{{ object.appraisal_note }}</p>
			</div>
			{% if user.is_appraiser %}
			<div class="box-footer">
				<button type="submit" class="btn btn-primary">Save</button>
				<button type="cancel" class="btn btn-danger">Cancel</button>
			</div>
			{% endif %}
		</div>
	</div>
</div>
{% endif %}

{% if object.get_errors %}
<div class="row">
	<div class="col-md-12">
		<div class="box box-danger">
			<div class="box-header with-border">
				<h3 class="box-title">Error Messages</h3>
			</div>
			<div class="box-body">

				<table class= "table table-striped dataTable">
					<thead>
						<tr>
							<th>Date/Time</th>
							<th>Summary</th>
							<th>Details</th>
						</tr>
					</thead>
					<tbody>
						{% for err in object.get_errors %}
						<tr>
							<td>{{ err.created_time }}</td>
							<td>{{ err.code.code_desc }}</td>
							<td>{% if object.additional_error_info %}{{ object.additional_error_info }}{% else %}No additional details available.{% endif %}</td>
						</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
		</div>
	</div>
</div>
{% endif %}

<div class="row">
	<div class="col-md-12">
		<div class="box box-info">
			<div class="box-header with-border">
				<h3 class="box-title">Log</h3>
			</div>
			<div class="box-body">
				<table class="table table-striped dataTable">
					<thead>
						<tr>
							<th>Date/Time</th>
							<th>Message</th>
						</tr>
					</thead>
					<tbody>
						{% for tlog in object.get_transfer_logs %}
						<tr>
							<td>{{ tlog.created_time }}</td>
							<td>{{ tlog.code.code_desc }}</td>
						</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
		</div>
	</div>
</div>

{% if object.rights_statements %}
<div class="row">
	<div class="col-md-12">
		<div class="box box-info">
			<div class="box-header with-border">
				<h3 class="box-title">Rights Statements</h3>
			</div>
			<div class="box-body no-padding">
				{% include 'parts/rights_table.html' with org=object %}
			</div>
		</div>
	</div>
</div>
{% endif %}

{% endblock %}


{% block modals %}
	{% include 'rights/modals/confirm_delete.html' %}
{% endblock %}


{% block extra_js %}
<script type="text/javascript" src="{% static 'js/rights_js.js' %}"></script>
{% endblock %}
